// let correct_solution = [
// 	[
// 	  -0.9605498328316118,
// 	  0.23704781236833064
// 	],
// 	[
// 	  -0.9605498328316118,
// 	  -0.2370478123683306
// 	],
// 	[
// 	  -0.9514843080198894,
// 	  -0.0931646853785445
// 	],
// 	[
// 	  -0.9514843080198893,
// 	  0.09316468537854446
// 	],
// 	[
// 	  -0.856386408308992,
// 	  0.4834243228069274
// 	],
// 	[
// 	  -0.856386408308992,
// 	  -0.4834243228069274
// 	],
// 	[
// 	  -0.784748481680098,
// 	  -2.1958007477013066e-19
// 	],
// 	[
// 	  -0.7138386355396291,
// 	  -0.6878258961361562
// 	],
// 	[
// 	  -0.713838635539629,
// 	  0.6878258961361561
// 	],
// 	[
// 	  -0.6359367790676003,
// 	  -0.7390587456318473
// 	],
// 	[
// 	  -0.6359367790676003,
// 	  0.7390587456318471
// 	],
// 	[
// 	  -0.515668555422614,
// 	  0.8482552974391387
// 	],
// 	[
// 	  -0.5156685554226136,
// 	  -0.8482552974391385
// 	],
// 	[
// 	  -0.478023127173484,
// 	  0.8605602818213052
// 	],
// 	[
// 	  -0.47802312717348316,
// 	  -0.8605602818213061
// 	],
// 	[
// 	  -0.39245604506773,
// 	  0.8775869582907676
// 	],
// 	[
// 	  -0.39245604506772974,
// 	  -0.8775869582907676
// 	],
// 	[
// 	  -0.22279453332792087,
// 	  -0.9397611554297287
// 	],
// 	[
// 	  -0.22279453332792085,
// 	  0.9397611554297288
// 	],
// 	[
// 	  -0.07158908723373421,
// 	  0.9417138147721346
// 	],
// 	[
// 	  -0.07158908723373365,
// 	  -0.9417138147721346
// 	],
// 	[
// 	  0.009537541354919472,
// 	  0.9405733998803929
// 	],
// 	[
// 	  0.009537541354919805,
// 	  -0.9405733998803931
// 	],
// 	[
// 	  0.18981152490047185,
// 	  0.9363577460744197
// 	],
// 	[
// 	  0.18981152490047218,
// 	  -0.9363577460744191
// 	],
// 	[
// 	  0.2758047223146968,
// 	  0.9529334415218307
// 	],
// 	[
// 	  0.27580472231469694,
// 	  -0.9529334415218316
// 	],
// 	[
// 	  0.43783058404240344,
// 	  -0.8736391342586232
// 	],
// 	[
// 	  0.43783058404240366,
// 	  0.873639134258623
// 	],
// 	[
// 	  0.46586486028676666,
// 	  0.7173025682286035
// 	],
// 	[
// 	  0.4658648602867674,
// 	  -0.7173025682286038
// 	],
// 	[
// 	  0.5909769234832869,
// 	  -0.7727752633753683
// 	],
// 	[
// 	  0.5909769234832912,
// 	  0.772775263375369
// 	],
// 	[
// 	  0.6867128250895723,
// 	  0.7153412049536743
// 	],
// 	[
// 	  0.6867128250895733,
// 	  -0.7153412049536743
// 	],
// 	[
// 	  0.7073551211253396,
// 	  0.5837279472549547
// 	],
// 	[
// 	  0.707355121125341,
// 	  -0.583727947254957
// 	],
// 	[
// 	  0.7219258712259381,
// 	  0.23911933367505228
// 	],
// 	[
// 	  0.7219258712259423,
// 	  -0.23911933367504995
// 	],
// 	[
// 	  0.8562595344022053,
// 	  0.506936719725395
// 	],
// 	[
// 	  0.8562595344022067,
// 	  -0.5069367197253959
// 	],
// 	[
// 	  0.9236198118150012,
// 	  -0.35859657009344825
// 	],
// 	[
// 	  0.9236198118150019,
// 	  0.35859657009344587
// 	],
// 	[
// 	  0.9741116630145235,
// 	  -0.11112617045472425
// 	],
// 	[
// 	  0.9741116630145659,
// 	  0.11112617045471403
// 	],
// 	[
// 	  0.9768978644941941,
// 	  5.921039986780381e-13
// 	],
// 	[
// 	  0.9807711773498792,
// 	  0.03258839167061349
// 	],
// 	[
// 	  0.980771177350159,
// 	  -0.032588391670753995
// 	]
//   ]
//   let a_test = [
// 	-0.10289929845982222,
// 	0.5463845572543825,
// 	-1.4167040709734704,
// 	2.4303077002737625,
// 	-3.070583763403482,
// 	2.812993566028295,
// 	-1.2410807855316688,
// 	-1.8321067660967922,
// 	6.014525494753355,
// 	-10.405645545044445,
// 	13.809543624386052,
// 	-14.941331067676288,
// 	13.09502103257191,
// 	-8.480413803896154,
// 	2.0549041581059275,
// 	4.929028808276634,
// 	-10.962969381651194,
// 	14.731737240561774,
// 	-15.496022837078723,
// 	13.303244263898717,
// 	-9.215547933940732,
// 	4.513211445028393,
// 	-0.1727937511789044,
// 	-3.29318102343088,
// 	5.800472311540929,
// 	-7.76648138472868,
// 	9.755211314179197,
// 	-11.758724190863616,
// 	13.278843604956895,
// 	-13.694201038780282,
// 	12.145201042306532,
// 	-7.9703647919982545,
// 	1.4368003711714017,
// 	6.109957223032878,
// 	-12.79211615846229,
// 	16.948612018337165,
// 	-17.22699906936544,
// 	13.219217323028799,
// 	-5.675827365990973,
// 	-4.007574079901229,
// 	13.887375252532063,
// 	-21.554325028987403,
// 	25.139498337707177,
// 	-24.307404078947012,
// 	20.384116384532188,
// 	-15.043353686303057,
// 	9.318491895907107,
// 	-4.2358590796378115,
// 	1
//   ];
//   // let solution = findRoots(a_test, undefined, undefined, 1e-6);
//   // //sort solution=[[real parts], [complex parts]] by real part
//   // solution = solution[0].map((x, i) => [Math.round(100000*x)/100000, Math.round(100000*solution[1][i])/100000]).sort((a, b) => a[0] - b[0]);
//   // //also round correct_solution
//   // correct_solution = correct_solution.map(x => [Math.round(100000*x[0])/100000, Math.round(100000*x[1])/100000]);
//   // //filter out elements with negative imaginary part
//   // solution = solution.filter(x => x[1] >= 0);
//   // correct_solution = correct_solution.filter(x => x[1] >= 0);
//   // //subtract solution from correct solution and get maximum difference
//   // let max_diff = Math.max(...solution.map((x, i) => Math.abs(x[0] - correct_solution[i][0]) + Math.abs(x[1] - correct_solution[i][1])));
//   // console.log(max_diff);
//   // //get element with max diff
//   // let max_diff_elem = solution.map((x, i) => [Math.abs(x[0] - correct_solution[i][0]) + Math.abs(x[1] - correct_solution[i][1]), i]).sort((a, b) => b[0] - a[0])[0];
//   // console.log(solution);
//   // console.log(max_diff_elem);
//   //check if the max_diff is zero when the algorithm is run 10000 times
//   let max_diff = 0;
  
//   correct_solution = correct_solution.map(x => [Math.round(100000*x[0])/100000, Math.round(100000*x[1])/100000]);
//   correct_solution = correct_solution.filter(x => x[1] > 0);
//   for (let i = 0; i < 10000; i++){
// 	//log i if i is a multiple of 1000
// 	if (i % 100 == 0){
// 	  console.log(i);
// 	  console.log(max_diff);
// 	}
  
// 	let solution = findRoots(a_test, undefined, undefined, 1e-6);
// 	//sort solution=[[real parts], [complex parts]] by real part
// 	solution = solution[0].map((x, i) => [Math.round(100000*x)/100000, Math.round(100000*solution[1][i])/100000]).sort((a, b) => a[0] - b[0]);
// 	//also round correct_solution
// 	//filter out elements with negative imaginary part
// 	solution = solution.filter(x => x[1] > 0);
// 	//subtract solution from correct solution and get maximum difference
// 	let max_diff_temp = Math.max(...solution.map((x, i) => Math.abs(x[0] - correct_solution[i][0]) + Math.abs(x[1] - correct_solution[i][1])));
// 	if (max_diff_temp > max_diff){
// 	  max_diff = max_diff_temp;
// 	}
//   }
//   console.log(max_diff);
//   alert();
  




let samplingRate = 11000;

//set sample rate from audio context to support other mics
let data = [];
let audioCtx = new AudioContext({sampleRate: samplingRate});
let start = false;
document.onkeypress = function (e) {
    e = e || window.event;
	let curves = LPC.smooth_formants(data);
	if(!start){
		start = true;
		audioCtx.resume();
		navigator.mediaDevices.getUserMedia({ audio: true }).then(async stream => {
			
		    let audioInput = audioCtx.createMediaStreamSource(stream);

		    await audioCtx.audioWorklet.addModule("worklet.js");

		    analyzer = audioCtx.createAnalyser();
			analyzer.fftSize = 2048;
		    audioInput.connect(analyzer);

		    let worklet = new AudioWorkletNode(audioCtx, "recorder");
		    audioInput.connect(worklet);

		    worklet.port.onmessage = e => {
			  let timedomain = new Float32Array(analyzer.frequencyBinCount);
		      analyzer.getFloatTimeDomainData(timedomain);
			  data = timedomain;
		    };
		// for(let i = 0; i < 11;i++){
		//   let a = LPC.solve_yule_walker(data, 11+i);
		//   a = a.map(x => -x);
		//   a.unshift(1);
		//   let p = LPC.accurate_peaks(a);
		//   peaks.push(p);
		// }
		});
	}
	// console.log(data);
	// let x = LPC.accurate_peaks(LPC.solve_yule_walker(data, 13));
	// console.log(x);
	// let coeffs = LPC.legendre4_coeffs(x.map(y => y[0]));
	// console.log(coeffs);
	// let res = LPC.legendre4(coeffs, -1);
	// console.log(res);
	// console.log(curves);
};